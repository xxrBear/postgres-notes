# 连接语句 

## FORM 子句

`FORM` 子句用于 PostgreSQL 的查询语句中，其后可选地跟随 WHERE 、 GROUP BY 和 HAVING 子句。所有这些子句都会转换生成一个虚拟表，该虚拟表提供传递给选择列表的行，以计算查询的输出行。

## 连接类型

连接表是根据特定连接类型的规则从另外两个（实际或派生）表派生出来的表。可用的连接类型包括内连接、外连接和交叉连接。连接表的一般语法是
```
T1 join_type T2
```

- 交叉连接

交叉连接语句就像这样：

```sql
T1 CROSS JOIN T2
```

对于来自 T1 和 T2 的每一行可能的组合即笛卡尔积，连接表将包含一行，该行由 T1 中的所有列后跟 T2 中的所有列组成。如果表分别有 N 行和 M 行，则连接表将有 N * M 行

> 如果有一个表里面的数据是空的，那么返回的结果也是空的

- 内连接
```sql
T1 INNER JOIN T2;
```
对于 T1 中的每一行 R1，连接表会为 T2 中满足与 R1 连接条件的每一行生成一行。

- 左外连接
```sql
T1 LEFT JOIN T2;
```
首先执行内连接。然后，对于 T1 中未与 T2 任何行满足连接条件的每一行，会添加一个连接行，其中 T2 的列值为空。因此，连接表始终为 T1 的每一行至少保留一行。

- 右外连接
```sql
T1 RIGHT OUTER JOIN T2;
```
首先执行内连接。然后，对于 T2 中未与 T1 任何行满足连接条件的每一行，会添加一个连接行，其中 T1 的列值为空。这是左连接的反向操作：结果表始终会为 T2 的每一行保留一行。

- 全外连接
```sql
T1 FULL OUTER JOIN T2;
```
首先执行内连接。然后，对于 T1 中未与 T2 中任何行满足连接条件的每一行，会添加一个连接行，其中 T2 的列值为空。同样，对于 T2 中未与 T1 中任何行满足连接条件的每一行，也会添加一个连接行，其中 T1 的列值为空。

- 连接条件

ON 子句是最通用的连接条件类型：它接受与 WHERE 子句中使用的同类型的布尔值表达式。当 ON 表达式的求值结果为真时，来自 T1 和 T2 的一对行即匹配。

`USING` 子句是一种简写形式，它允许您在连接两侧对连接列使用相同名称的特殊情况下进行利用。它接受一个以逗号分隔的共享列名列表，并形成一个包含每个列相等比较的连接条件。例如，使用 `USING (a, b)` 连接 `t1` 和 `t2` 会产生连接条件 `t1.a = t2.a AND t1.b = t2.b`。

此外， JOIN USING 的输出会抑制冗余列：由于匹配的列必须具有相等的值，因此无需同时打印这两列。虽然 JOIN ON 会生成 T1 的所有列，后跟 T2 的所有列，但 JOIN USING 会为每个列对（按列出的顺序）生成一个输出列，然后是 T1 中剩余的列，最后是 T2 中剩余的列。

最后， NATURAL 是 USING 的简写形式：它构建一个 USING 列表，包含两个输入表中出现的所有列名。与 USING 一样，这些列在输出表中仅出现一次。如果没有共同的列名， NATURAL JOIN 的行为类似于 CROSS JOIN 

## 内连接

在 PostgreSQL 中，INNER JOIN 的行为如下：

> 只返回两个表中满足 ON 条件的匹配行

- 执行内连接
演示数据，可从example.sql中获取

```sql
SELECT
    e.name AS employee_name,
    d.name AS department_name
FROM
    employee e
INNER JOIN
    department d ON e.dept_id = d.id;
```

## 外连接

postgres 中有多种不同的外连接语句，左连接、右连接、全外连接、交叉连接

| 类型                         | 描述                                                      |
| ---------------------------- | --------------------------------------------------------- |
| LEFT OUTER JOIN（左外连接）  | 保留左表全部记录，即使右表中没有匹配的也保留，右表补 NULL |
| RIGHT OUTER JOIN（右外连接） | 保留右表全部记录，左表没有匹配的补 NULL                   |
| FULL OUTER JOIN（全外连接）  | 左右两边都保留，没有匹配的那一边用 NULL 补上              |

左外连接
```sql
SELECT
    e.name AS employee_name,
    d.name AS department_name
FROM
    employee e
LEFT JOIN
    department d ON e.dept_id = d.id;
```

右外连接
```sql
SELECT
    e.name AS employee_name,
    d.name AS department_name
FROM
    employee e
RIGHT JOIN
    department d ON e.dept_id = d.id;
```

全外连接
```sql
SELECT
    e.name AS employee_name,
    d.name AS department_name
FROM
    employee e
FULL OUTER JOIN
    department d ON e.dept_id = d.id;
```

交叉连接
```sql
SELECT
    e.name AS employee_name,
    d.name AS department_name
FROM
    employee e
CROSS JOIN
    department d;
```

[返回目录](/README.md)
