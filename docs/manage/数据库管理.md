## 数据库管理

### 创建数据库
当你想创建一个数据库的时候，如果你已经连接到了 postgres 你可以使用：
```sql
CREATE DATABASE name;
```
创建指定`name`的数据库。当然，你也可以使用`shell`命令来创建数据库

```shell
createdb name;
```

这个命令没有什么神奇的地方，如果你没有登录，它会让你输入密码登录。它连接到postgres数据库并发出CREATE DATABASE命令

### 模板数据库

`CREATE DATABASE`实际上是通过复制现有数据库来工作的。默认情况下，它会复制名为`template1`的标准系统数据库。 因此，该数据库是创建新数据库的模板。如果向`template1`添加对象，这些对象将被复制到随后创建的用户数据库中。此行为允许对数据库中的标准对象集进行站点本地修改。例如，如果在 template0 中安装了过程语言 PL/Perl，它将自动在用户数据库中可用，而无需在创建这些数据库时采取任何额外操作

但是，CREATE DATABASE 不会复制附加到源数据库的数据库级 GRANT 权限。新数据库具有默认的数据库级权限

还有一个名为`template0`的第二个标准系统数据库。 此数据库包含与`template1`的初始内容相同的数据，即只有您的 PostgreSQL 版本预定义的标准对象。template0 在数据库集群初始化后不应进行任何更改。通过指示 CREATE DATABASE 复制 template0 而不是 template1，您可以创建一个“原始”用户数据库（其中不存在任何用户定义的对象，并且系统对象没有被更改），其中不包含 template1 中的任何站点本地添加。当还原 pg_dump 转储时，这特别方便：转储脚本应还原到原始数据库中，以确保重新创建转储数据库的正确内容，而不会与可能在以后添加到 template1 的对象冲突

复制 template0 而不是 template1 的另一个常见原因是，在复制 template0 时可以指定新的编码和区域设置，而 template1 的副本必须使用相同的设置。这是因为 template1 可能包含特定于编码或区域设置的数据，而 template0 已知不包含

要通过复制 template0 创建数据库，请使用
```sql
CREATE DATABASE dbname TEMPLATE template0;
```

或者`shell`命令

```shell
createdb -T template0 dbname
```

可以创建其他模板数据库，事实上，可以通过将集群中任何数据库的名称指定为 CREATE DATABASE 的模板来复制该数据库。但重要的是要理解，这（还）不打算作为通用的 “COPY DATABASE”工具。主要的限制是，在复制源数据库时，不能有其他会话连接到该数据库。CREATE DATABASE 如果在启动时存在任何其他连接，则会失败；在复制操作期间，会阻止与源数据库的新连接

在 pg_database 中，每个数据库都有两个有用的标志：datistemplate 和 datallowconn 列。datistemplate 可以设置为指示数据库旨在作为 CREATE DATABASE 的模板。如果设置了此标志，则任何具有 CREATEDB 权限的用户都可以克隆该数据库；如果未设置，则只有超级用户和数据库的所有者可以克隆该数据库。如果 datallowconn 为 false，则不允许与该数据库建立任何新连接（但现有会话不会因为简单地设置该标志为 false 而终止）。template0 数据库通常标记为 datallowconn = false，以防止其被修改。template0 和 template1 都应始终标记为 datistemplate = true

> [!Tip]
> template1 和 template0 除了 template1 的名称是 CREATE DATABASE 的默认源数据库名称这一事实之外，没有任何特殊状态。
> 例如，可以删除 template1 并从 template0 重新创建它，而不会产生任何不良影响。如果有人不小心在 template1 中添加了一堆垃圾，则此操作可能是明智的。（要删除 template1，它必须具有 pg_database.datistemplate = false。）
> 当初始化数据库集群时，也会创建 postgres 数据库。此数据库旨在作为用户和应用程序连接的默认数据库。它只是 template1 的副本，如有必要，可以删除并重新创建

[返回目录](#目录)