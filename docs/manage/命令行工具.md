# 命令行工具

## 简介

PostgreSQL 的命令行工具是指一组用于管理 PG 数据库的命令行程序。它们功能强大、灵活、适用于日常数据库操作、维护、备份、恢复、性能调优等

## 常用的命令行工具

| 工具名称        | 作用简介                                          |
| --------------- | ------------------------------------------------- |
| `pg_dump`       | 数据库备份工具，导出数据库为 SQL 脚本或自定义格式 |
| `pg_restore`    | 恢复备份数据到数据库                              |
| `createdb`      | 创建新数据库                                      |
| `dropdb`        | 删除数据库                                        |
| `createuser`    | 创建新用户/角色                                   |
| `dropuser`      | 删除用户/角色                                     |
| `pg_ctl`        | 控制 PostgreSQL 服务器的启动、停止和重启          |
| `pg_basebackup` | 基于流复制的备份工具                              |
| `reindexdb`     | 重建数据库索引                                    |
| `vacuumdb`      | 命令行运行 VACUUM 和 ANALYZE                      |
| `psql`          | 交互式查询工具                                    |
| `pg_isready`    | 检查数据库服务是否运行                            |

## 交互式查询

`psql`是一个 PostgreSQL 的基于终端的前端。它让你能交互式地键入查询，把它们发送给PostgreSQL，并且查看查询结果。或者，输入可以来自于一个文件或者命令行参数。此外，psql还提供一些元命令和多种类似 shell 的特性来为编写脚本和自动化多种任务提供便利。

- 连接数据库

如果你是使用二进制文件安装的`postgres`数据库，你可以在终端中输入下面的命令:

```shell
psql -U postgres -d mydb
```
然后输入你的数据库密码，如果一切正常，你会看到类似以下的输出

```
用户 postgres 的口令：

psql (16.9)
输入 "help" 来获取帮助信息.

mydb=#

mydb=# \d -- 显示 mydb 所有表
                        关联列表
 架构模式 |          名称           |  类型  |  拥有者
----------+-------------------------+--------+----------
 public   | alembic_version         | 数据表 | postgres
 public   | app_user                | 数据表 | postgres
 public   | app_user2               | 数据表 | postgres
 public   | passwd                  | 数据表 | postgres
 public   | pg_stat_statements      | 视图   | postgres
 public   | pg_stat_statements_info | 视图   | postgres
 public   | products                | 数据表 | postgres
 public   | test_lock               | 数据表 | postgres
 public   | test_lock_id_seq        | 序列数 | postgres
 public   | users                   | 数据表 | postgres
(10 行记录)
```
这表明你已经成功的连接上了你本地的 PG 数据库

- 常见的psql指令

| 命令             | 说明                                  |
| ---------------- | ------------------------------------- |
| `\q`             | 退出 psql                             |
| `\c [数据库名]`  | 连接/切换数据库                       |
| `\d`             | 显示当前数据库所有表                  |
| `\d [表名]`      | 显示指定表结构（列、类型、约束等）    |
| `\dt`            | 显示当前数据库所有普通表              |
| `\dv`            | 显示当前数据库所有视图                |
| `\df`            | 显示当前数据库所有函数                |
| `\l`             | 列出所有数据库                        |
| `\dn`            | 列出所有模式（schema）                |
| `\du`            | 显示所有用户/角色                     |
| `\set`           | 设置变量                              |
| `\x`             | 切换扩展显示模式（更易读表格）        |
| `\timing`        | 开启/关闭查询耗时显示                 |
| `\! [shell命令]` | 在 psql 中执行 shell 命令             |
| `\copy`          | 导入/导出表数据（类似 \copy FROM/TO） |
| `\i [文件名]`    | 执行指定 SQL 脚本文件                 |
| `\watch [秒]`    | 每隔多少秒重复执行前一条查询          |
| `\conninfo`      | 显示当前连接信息                      |

[返回目录](/README.md)
